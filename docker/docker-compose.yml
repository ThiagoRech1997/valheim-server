services:
  valheim:
    image: lloesche/valheim-server
    container_name: valheim-server
    restart: unless-stopped
    stop_grace_period: 120s
    cap_add:
      - SYS_NICE
    ports:
      - "2456-2458:2456-2458/udp"
      - "2456-2458:2456-2458/tcp"
    environment:
      # Configurações do servidor
      - SERVER_NAME=${SERVER_NAME:-My Valheim Server}
      - WORLD_NAME=${WORLD_NAME:-MyWorld}
      - SERVER_PASS=${SERVER_PASS:-secret123}
      - SERVER_PUBLIC=true

      # Configurações de recursos (otimizado para 2 cores / 8GB RAM)
      - SERVER_ARGS=-crossplay -modifier raids ${RAID_MODIFIER:-default} -modifier portals ${PORTAL_MODIFIER:-default} -modifier deathpenalty ${DEATH_PENALTY:-default} -modifier resources ${RESOURCE_MODIFIER:-default} -modifier enemies ${ENEMY_MODIFIER:-default} -modifier combat ${COMBAT_MODIFIER:-default} -setkey ${WORLD_PRESET:-normal}

      # =============================================
      # MODIFICADORES DE GAMEPLAY (mesmo da Steam)
      # =============================================
      # Presets de mundo (setkey):
      #   normal, casual, easy, hard, hardcore, immersive, hammer
      - WORLD_PRESET=${WORLD_PRESET:-normal}

      # Modificador de Raids (ataques de inimigos na base):
      #   none, muchless, less, default, more, muchmore
      - RAID_MODIFIER=${RAID_MODIFIER:-default}

      # Modificador de Portais:
      #   casual (permite tudo), default (sem minério), hard (sem itens)
      - PORTAL_MODIFIER=${PORTAL_MODIFIER:-default}

      # Penalidade de Morte:
      #   casual (sem perda), veryeasy, easy, default, hard, hardcore (perda permanente)
      - DEATH_PENALTY=${DEATH_PENALTY:-default}

      # Modificador de Recursos (quantidade de drop):
      #   muchless, less, default, more, muchmore, most
      - RESOURCE_MODIFIER=${RESOURCE_MODIFIER:-default}

      # Modificador de Inimigos (quantidade e nível):
      #   none, veryless, less, default, more, muchmore
      - ENEMY_MODIFIER=${ENEMY_MODIFIER:-default}

      # Modificador de Combate (dano recebido/causado):
      #   veryeasy, easy, default, hard, veryhard
      - COMBAT_MODIFIER=${COMBAT_MODIFIER:-default}

      # Backups automáticos
      - BACKUPS=true
      - BACKUPS_INTERVAL=7200
      - BACKUPS_DIRECTORY=/config/backups
      - BACKUPS_MAX_AGE=7
      - BACKUPS_MAX_COUNT=10

      # Atualizações
      - UPDATE_CRON=0 5 * * *
      - UPDATE_IF_IDLE=true

      # Timezone
      - TZ=America/Sao_Paulo

      # IDs do usuário/grupo
      - PUID=1000
      - PGID=1000
    volumes:
      - valheim-config:/config
      - valheim-data:/opt/valheim
    deploy:
      resources:
        limits:
          memory: 6G
        reservations:
          memory: 4G

volumes:
  valheim-config:
    driver: local
  valheim-data:
    driver: local
